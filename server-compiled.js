(()=>{var e={778:(e,t,a)=>{const n=a(185);e.exports=e=>n.connect(e)},438:(e,t,a)=>{const n=a(185),s=new n.Schema({name:{type:String,name:[!0,"must provide name"],trim:!0,maxlength:[20,"name can not be more than 20 characters"]},species:{type:String,species:[!0,"must provide name"],trim:!0,maxlength:[20,"name can not be more than 20 characters"]},photo:{type:String,photo:[!1],trim:!0}});e.exports=n.model("Model",s)},417:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});const n=require("axios");var s=a.n(n),o=a(689),r=a.n(o);const i=function(e){const[t,a]=(0,o.useState)(!1),[n,i]=(0,o.useState)(""),[c,l]=(0,o.useState)(),[d,m]=(0,o.useState)("");return r().createElement("div",{className:"card"},r().createElement("div",{className:"our-card-top"},t&&r().createElement("div",{className:"our-custom-input"},r().createElement("div",{className:"our-custom-input-interior"},r().createElement("input",{onChange:e=>l(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),r().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`${e.species} named ${e.name}`})),r().createElement("div",{className:"card-body"},!t&&r().createElement(r().Fragment,null,r().createElement("h4",null,e.name),r().createElement("p",{className:"text-muted small"},e.species),!e.readOnly&&r().createElement(r().Fragment,null,r().createElement("button",{onClick:()=>{a(!0),i(e.name),m(e.species),l("")},className:"btn btn-sm btn-primary"},"Edit")," ",r().createElement("button",{onClick:async()=>{s().delete(`/animal/${e.id}`),e.setAnimals((t=>t.filter((t=>t._id!=e.id))))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&r().createElement("form",{onSubmit:async function(t){t.preventDefault(),a(!1),e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,name:n,species:d}:t}))));const o=new FormData;c&&o.append("photo",c),o.append("_id",e.id),o.append("name",n),o.append("species",d);const r=await s().post("/update-animal",o,{headers:{"Content-Type":"multipart/form-data"}});r.data&&e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,photo:r.data}:t}))))}},r().createElement("div",{className:"mb-1"},r().createElement("input",{autoFocus:!0,onChange:e=>i(e.target.value),type:"text",className:"form-control form-control-sm",value:n})),r().createElement("div",{className:"mb-2"},r().createElement("input",{onChange:e=>m(e.target.value),type:"text",className:"form-control form-control-sm",value:d})),r().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",r().createElement("button",{onClick:()=>a(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},470:e=>{"use strict";e.exports=require("fs-extra")},13:e=>{"use strict";e.exports=require("mongodb")},185:e=>{"use strict";e.exports=require("mongoose")},738:e=>{"use strict";e.exports=require("multer")},689:e=>{"use strict";e.exports=require("react")},684:e=>{"use strict";e.exports=require("react-dom/server")},109:e=>{"use strict";e.exports=require("sanitize-html")},441:e=>{"use strict";e.exports=require("sharp")},17:e=>{"use strict";e.exports=require("path")}},t={};function a(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const{MongoClient:e,ObjectId:t}=a(13),n=a(860),s=a(438),o=a(738);a(142).config();const r=a(778),i=process.env.PORT||3e3,c=o(),l=a(109),d=a(470),m=a(441),p=process.env.AUTH_VAL,u=a(17),b=a(689),f=a(684),g=a(417).Z;d.ensureDirSync(u.join("public","uploaded-photos"));const h=n();function y(e,t,a){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.species&&(e.body.species=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:l(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),species:l(e.body.species.trim(),{allowedTags:[],allowedAttributes:{}})},a()}h.set("view engine","ejs"),h.set("views","./views"),h.use(n.static("public")),h.use(n.json()),h.use(n.urlencoded({extended:!1})),h.get("/",(async(e,t)=>{const a=await s.find({}),n=f.renderToString(b.createElement("div",{className:"container"},!a.length&&b.createElement("p",null,"There are no animals yet, the admin needs to add a few."),b.createElement("div",{className:"animal-grid mb-3"},a.map((e=>b.createElement(g,{key:e._id,name:e.name,species:e.species,photo:e.photo,id:e._id,readOnly:!0})))),b.createElement("p",null,b.createElement("a",{href:"/admin"},"Login / manage the animal listings."))));t.render("home",{generatedHTML:n})})),h.use((function(e,t,a){t.set("WWW-Authenticate","Basic realm='Our MERN App'"),e.headers.authorization==p?a():(console.log(e.headers.authorization),t.status(401).send("Try again"))})),h.get("/admin",((e,t)=>{t.render("admin")})),h.get("/api/animals",(async(e,t)=>{const a=await s.find({});t.status(200).json(a)})),h.post("/create-animal",c.single("photo"),y,(async(e,t)=>{if(e.file){const t=`${Date.now()}.jpg`;await m(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(u.join("public","uploaded-photos",t)),e.cleanData.photo=t}const a=await s.create(e.cleanData);t.send(a)})),h.delete("/animal/:id",(async(e,a)=>{"string"!=typeof e.params.id&&(e.params.id="");const n=await s.findOne({_id:new t(e.params.id)});await s.findOneAndDelete({_id:new t(e.params.id)}),n.photo&&d.remove(u.join("public","uploaded-photos",n.photo)),a.send("Good job")})),h.post("/update-animal",c.single("photo"),y,(async(e,a)=>{if(e.file){const n=`${Date.now()}.jpg`;await m(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(u.join("public","uploaded-photos",n)),e.cleanData.photo=n;const o=await s.findOne({_id:new t(e.body._id)});await s.findOneAndUpdate({_id:new t(e.body._id)},e.cleanData,{new:!0,runValidators:!0}),o.photo&&d.remove(u.join("public","uploaded-photos",o.photo)),a.send(n)}else await s.findOneAndUpdate({_id:new t(e.body._id)},e.cleanData,{new:!0,runValidators:!0}),a.send(!1)})),async function(){await r(process.env.MONGO_URI),h.listen(i,(()=>console.log(`listening at ${i}`)))}()})()})();